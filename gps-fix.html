<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS修復測試</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-card { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        button { padding: 15px 25px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; margin: 5px; }
        .gps-btn { background: #28a745; color: white; }
        .sensor-btn { background: #007bff; color: white; }
        .result { margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8; }
    </style>
</head>
<body>
    <h1>🔧 GPS和感應器修復測試</h1>
    
    <div class="test-card">
        <h2>📍 GPS測試</h2>
        <button class="gps-btn" onclick="testGPS()">測試GPS權限</button>
        <div id="gps-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-card">
        <h2>📱 感應器測試</h2>
        <button class="sensor-btn" onclick="testSensor()">測試感應器權限</button>
        <div id="sensor-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-card">
        <h2>🔍 調試信息</h2>
        <div id="debug-info" class="info"></div>
    </div>

    <script>
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = message;
            element.className = `result ${type}`;
        }
        
        function testGPS() {
            console.log('開始GPS測試...');
            showResult('gps-result', '正在測試GPS...', 'info');
            
            if (!navigator.geolocation) {
                showResult('gps-result', '❌ 瀏覽器不支援GPS', 'error');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    console.log('GPS成功:', position);
                    const msg = `✅ GPS成功！\n緯度: ${position.coords.latitude}\n經度: ${position.coords.longitude}\n精度: ${position.coords.accuracy}米`;
                    showResult('gps-result', msg, 'success');
                },
                function(error) {
                    console.log('GPS失敗:', error);
                    let msg = '❌ GPS失敗: ';
                    if (error.code === 1) {
                        msg += '權限被拒絕 - 請在瀏覽器中允許位置權限';
                    } else if (error.code === 2) {
                        msg += '位置不可用 - 請檢查GPS設定';
                    } else if (error.code === 3) {
                        msg += '定位超時 - 請重試';
                    } else {
                        msg += error.message;
                    }
                    showResult('gps-result', msg, 'error');
                },
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
            );
        }
        
        function testSensor() {
            console.log('開始感應器測試...');
            showResult('sensor-result', '正在測試感應器...', 'info');
            
            if (typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function") {
                console.log('需要請求感應器權限...');
                DeviceMotionEvent.requestPermission().then(response => {
                    console.log('感應器權限結果:', response);
                    if (response === "granted") {
                        showResult('sensor-result', '✅ 感應器權限已允許', 'success');
                        startSensorListen();
                    } else {
                        showResult('sensor-result', '❌ 感應器權限被拒絕', 'error');
                    }
                }).catch(error => {
                    console.log('感應器權限錯誤:', error);
                    showResult('sensor-result', '❌ 感應器權限請求失敗: ' + error.message, 'error');
                });
            } else {
                console.log('直接啟用感應器...');
                showResult('sensor-result', '✅ 感應器已啟用（無需權限）', 'success');
                startSensorListen();
            }
        }
        
        function startSensorListen() {
            let count = 0;
            window.addEventListener('devicemotion', function(e) {
                count++;
                if (count === 1) {
                    showResult('sensor-result', '✅ 感應器正常工作！檢測到動作數據', 'success');
                }
                console.log('感應器數據:', e.acceleration);
            });
        }
        
        // 顯示調試信息
        window.onload = function() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.innerHTML = `
                <strong>瀏覽器信息：</strong><br>
                User Agent: ${navigator.userAgent}<br>
                GPS支援: ${!!navigator.geolocation}<br>
                感應器支援: ${!!window.DeviceMotionEvent}<br>
                感應器需要權限: ${typeof DeviceMotionEvent.requestPermission === 'function'}<br>
                HTTPS: ${location.protocol === 'https:'}<br>
                當前URL: ${location.href}<br>
                <br>
                <strong>測試步驟：</strong><br>
                1. 點擊「測試GPS權限」按鈕<br>
                2. 當瀏覽器彈出權限請求時，點擊「允許」<br>
                3. 點擊「測試感應器權限」按鈕<br>
                4. 當瀏覽器彈出權限請求時，點擊「允許」<br>
                5. 查看結果
            `;
        };
    </script>
</body>
</html>
