<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¬Šé™æ¸¬è©¦ - æœ€ç°¡ç‰ˆæœ¬</title>
  <style>
    body { 
      font-family: sans-serif; 
      padding: 20px; 
      background: #f5f5f5;
    }
    button { 
      padding: 15px 30px; 
      font-size: 18px; 
      cursor: pointer; 
      margin: 10px;
      border: none;
      border-radius: 8px;
      color: white;
    }
    #gpsBtn { background: #dc3545; }
    #sensorBtn { background: #007bff; }
    #bothBtn { background: #28a745; }
    #log { 
      margin-top: 20px; 
      white-space: pre-wrap; 
      background: white; 
      padding: 15px; 
      border: 1px solid #ddd; 
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
    }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .info { color: #007bff; }
  </style>
</head>
<body>
  <h1>ğŸ”§ æ¬Šé™æ¸¬è©¦ - æœ€ç°¡ç‰ˆæœ¬</h1>
  <p>è«‹ä¾åºæ¸¬è©¦æ¯å€‹æŒ‰éˆ•ï¼Œè§€å¯Ÿç€è¦½å™¨æ˜¯å¦å½ˆå‡ºæ¬Šé™è«‹æ±‚å°è©±æ¡†</p>
  
  <button id="gpsBtn">ğŸ“ æ¸¬è©¦GPSæ¬Šé™</button>
  <button id="sensorBtn">ğŸ“± æ¸¬è©¦æ„Ÿæ‡‰å™¨æ¬Šé™</button>
  <button id="bothBtn">ğŸš€ åŒæ™‚æ¸¬è©¦å…©è€…</button>
  
  <div id="log">ğŸ‘‰ è«‹é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>

  <script>
    const logBox = document.getElementById("log");
    const log = (msg, type = 'info') => {
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
      const logMsg = `[${timestamp}] ${msg}`;
      console.log(logMsg);
      logBox.innerHTML += `<span class="${className}">${logMsg}</span>\n`;
      logBox.scrollTop = logBox.scrollHeight;
    };

    // GPS æ¸¬è©¦
    document.getElementById("gpsBtn").addEventListener("click", () => {
      log("ğŸ“ é–‹å§‹æ¸¬è©¦GPSæ¬Šé™...");
      
      if (!navigator.geolocation) {
        log("âŒ ç€è¦½å™¨ä¸æ”¯æ´GPS API", 'error');
        return;
      }
      
      log("ğŸ”„ æ­£åœ¨è«‹æ±‚GPSæ¬Šé™...");
      navigator.geolocation.getCurrentPosition(
        (position) => {
          log(`âœ… GPSæ¬Šé™æˆåŠŸï¼åº§æ¨™: ${position.coords.latitude}, ${position.coords.longitude}`, 'success');
          log(`ğŸ“ ç²¾åº¦: ${position.coords.accuracy} å…¬å°º`, 'info');
        },
        (error) => {
          log(`âŒ GPSæ¬Šé™å¤±æ•—: ${error.message}`, 'error');
          log(`âŒ éŒ¯èª¤ä»£ç¢¼: ${error.code}`, 'error');
          if (error.code === 1) {
            log("ğŸ’¡ æç¤º: è«‹æª¢æŸ¥ç€è¦½å™¨ä½ç½®æ¬Šé™è¨­å®š", 'info');
          }
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    });

    // æ„Ÿæ‡‰å™¨æ¸¬è©¦
    document.getElementById("sensorBtn").addEventListener("click", () => {
      log("ğŸ“± é–‹å§‹æ¸¬è©¦æ„Ÿæ‡‰å™¨æ¬Šé™...");
      
      if (!window.DeviceMotionEvent) {
        log("âŒ ç€è¦½å™¨ä¸æ”¯æ´æ„Ÿæ‡‰å™¨API", 'error');
        return;
      }
      
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        log("ğŸ”„ æ­£åœ¨è«‹æ±‚æ„Ÿæ‡‰å™¨æ¬Šé™ (iOS)...");
        DeviceMotionEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              log("âœ… æ„Ÿæ‡‰å™¨æ¬Šé™æˆåŠŸï¼", 'success');
              log("ğŸ“± é–‹å§‹ç›£è½æ„Ÿæ‡‰å™¨æ•¸æ“š...", 'info');
              
              let count = 0;
              const listener = (e) => {
                if (e.acceleration && count < 3) {
                  count++;
                  log(`ğŸ“± æ„Ÿæ‡‰å™¨æ•¸æ“š ${count}: X=${e.acceleration.x?.toFixed(2)}, Y=${e.acceleration.y?.toFixed(2)}, Z=${e.acceleration.z?.toFixed(2)}`, 'info');
                  if (count >= 3) {
                    window.removeEventListener('devicemotion', listener);
                    log("âœ… æ„Ÿæ‡‰å™¨æ¸¬è©¦å®Œæˆï¼", 'success');
                  }
                }
              };
              window.addEventListener('devicemotion', listener);
              
              // 5ç§’å¾Œåœæ­¢ç›£è½
              setTimeout(() => {
                window.removeEventListener('devicemotion', listener);
              }, 5000);
            } else {
              log("âŒ æ„Ÿæ‡‰å™¨æ¬Šé™è¢«æ‹’çµ•", 'error');
            }
          })
          .catch(error => {
            log(`âŒ æ„Ÿæ‡‰å™¨æ¬Šé™è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
          });
      } else {
        log("âœ… Android/æ¡Œé¢ç€è¦½å™¨ï¼Œç›´æ¥æ¸¬è©¦æ„Ÿæ‡‰å™¨...", 'info');
        log("ğŸ“± é–‹å§‹ç›£è½æ„Ÿæ‡‰å™¨æ•¸æ“š...", 'info');
        
        let count = 0;
        const listener = (e) => {
          if (e.acceleration && count < 3) {
            count++;
            log(`ğŸ“± æ„Ÿæ‡‰å™¨æ•¸æ“š ${count}: X=${e.acceleration.x?.toFixed(2)}, Y=${e.acceleration.y?.toFixed(2)}, Z=${e.acceleration.z?.toFixed(2)}`, 'info');
            if (count >= 3) {
              window.removeEventListener('devicemotion', listener);
              log("âœ… æ„Ÿæ‡‰å™¨æ¸¬è©¦å®Œæˆï¼", 'success');
            }
          }
        };
        window.addEventListener('devicemotion', listener);
        
        // 5ç§’å¾Œåœæ­¢ç›£è½
        setTimeout(() => {
          window.removeEventListener('devicemotion', listener);
        }, 5000);
      }
    });

    // åŒæ™‚æ¸¬è©¦å…©è€…
    document.getElementById("bothBtn").addEventListener("click", () => {
      log("ğŸš€ é–‹å§‹åŒæ™‚æ¸¬è©¦GPSå’Œæ„Ÿæ‡‰å™¨æ¬Šé™...");
      
      // æ¸¬è©¦GPS
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            log(`âœ… GPSæˆåŠŸ: ${position.coords.latitude}, ${position.coords.longitude}`, 'success');
          },
          (error) => {
            log(`âŒ GPSå¤±æ•—: ${error.message}`, 'error');
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      }
      
      // æ¸¬è©¦æ„Ÿæ‡‰å™¨
      if (window.DeviceMotionEvent) {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
          DeviceMotionEvent.requestPermission()
            .then(response => {
              if (response === 'granted') {
                log("âœ… æ„Ÿæ‡‰å™¨æ¬Šé™æˆåŠŸï¼", 'success');
              } else {
                log("âŒ æ„Ÿæ‡‰å™¨æ¬Šé™è¢«æ‹’çµ•", 'error');
              }
            })
            .catch(error => {
              log(`âŒ æ„Ÿæ‡‰å™¨å¤±æ•—: ${error.message}`, 'error');
            });
        } else {
          log("âœ… æ„Ÿæ‡‰å™¨ç›´æ¥å¯ç”¨ (Android/æ¡Œé¢)", 'success');
        }
      }
    });

    // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºè¨­å‚™ä¿¡æ¯
    window.addEventListener('load', () => {
      log("ğŸ” è¨­å‚™ä¿¡æ¯:", 'info');
      log(`ğŸ“± User Agent: ${navigator.userAgent}`, 'info');
      log(`ğŸŒ å”è­°: ${location.protocol}`, 'info');
      log(`ğŸ“ GPSæ”¯æ´: ${!!navigator.geolocation}`, 'info');
      log(`ğŸ“± æ„Ÿæ‡‰å™¨æ”¯æ´: ${!!window.DeviceMotionEvent}`, 'info');
      log(`ğŸ” æ„Ÿæ‡‰å™¨éœ€è¦æ¬Šé™: ${typeof DeviceMotionEvent.requestPermission === 'function'}`, 'info');
    });
  </script>
</body>
</html>
